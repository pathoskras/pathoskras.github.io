<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>KRAS Annotation</title>
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="/drawerJs/drawerJs.css"/>
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/canvas/canvas.css">
	<style>
	body,
    html {
      {{! position: fixed; }}
      {{! width: 100vw; }}
    }
    div#footer {
        background: white;
        border-top: solid 1px black;
        height: 15vh;
        position: fixed;
        bottom: 0;
        width: 100vw;
    }
    #footer .nav-button {
        background: white;
        padding: 0.5vh;
        width: 15vh;
        height: 15vh;
        margin-right: -5px;
        cursor: pointer;
    }

    #footer .nav-button img {
        object-fit: cover;
    }
    #footer .nav-button:hover {
        border: solid 3px black;
        background: red;
    }

    img.bigImage, textarea.bigText {
        width: 70vw;
    }
    #noteBox {
        margin-top: 550px;
    }
	</style>
    {{> styles }}
    <script src="/js/vendor.min.js"></script>
    <script src="/drawerJs/drawerJs.standalone.js"></script>
    <script src="/js/showdown.min.js"></script>

</head>

<body>
    <div id="wrapper" class="container-fluid page">
        <div class="row">
            <div class="col-md-2 col-xs-3 sidebar">
                <span>Kras mutation</span>
                {{! <input placeholder="Placeholder"> }}
                <ul>
                    <li><a href="#Welcome" onclick="welcome()">Welcome</a></li>
                    {{#images}}
                    <li>
                        <a href="#{{image}}" onclick="openScreen({{id}})">{{name}}</a>
                    </li>
                    {{/images}}
                    <li><a href="#Email" onclick="email()">Email</a></li>
                </ul>
            </div>
            <div class="col-md-10 col-xs-9">
                {{> content }}
            {{! Content goes here! }}
                <form action="/saveDetails" id="saveForm" method="post">

                <div id='contentBox'></div>

                <div id="noteBox">
                    <h3>Notes:</h3>
                    <textarea name="text-1" id="text-1" class="bigText hidden" for="saveForm">{{text-1}}</textarea>
                    <textarea name="text-2" id="text-2" class="bigText hidden" for="saveForm">{{text-2}}</textarea>
                    <textarea name="text-3" id="text-3" class="bigText hidden" for="saveForm">{{text-3}}</textarea>
                    <textarea name="text-4" id="text-4" class="bigText hidden" for="saveForm">{{text-4}}</textarea>
                    <textarea name="text-5" id="text-5" class="bigText hidden" for="saveForm">{{text-5}}</textarea>
                </div>

                <div id="emailForm" class="hidden">
                    <table>
                        <tr><td>First Name:</td>
                        <td><input value="{{firstName}}" for="saveForm" id="firstName" name="firstName" value="" required="true"></td></tr>
                        <tr><td>Last Name:</td>
                        <td><input value="{{lastName}}" for="saveForm" id="lastName" name="lastName" value="" required="true"></td></tr>
                        <tr><td>Email:</td>
                        <td><input value="{{email}}" for="saveForm" id="email" name="email" type="email" value="" required="true"></td></tr>
                        <tr><td>Doctor:</td>
                        <td><input value="{{doctor}}" for="saveForm" id="doctor" name="doctor" value="" required="true"></td></tr>
                        <tr><td>Send email:</td>
                        <td><input type="checkbox" for="saveForm" name="tickedEmailBox"></td></tr>
                    </table>
                    <input value="Save details" type="submit">
                    <div id="hiddenData" style="display: none;">
                        <textarea value="{{lineData}}" name="lineData" id="lineData" for="saveForm"></textarea>
                        <input value="{{hash}}" name="hash" for="saveForm">
                    </div>
                </div>

                </form>
            </div>
        </div>
    
    </div>

{{!     
    <div id="footer">
        <div>
            <img class="nav-button" src="/images/home.png">
            {{#images} }
            <img class="nav-button" src="/images/{{image} }">
            {{/images} }
            <img class="nav-button" src="/images/email.png">

        </div>
    </div>
}}


{{> scripts }}

<script type="text/javascript">
const md = new showdown.Converter({openLinksInNewWindow: true});

function welcome() {
    hideEverything();

    $("#contentBox").html(md.makeHtml(`#The KRAS Gene

The KRAS gene provides instructions for making a protein called K-Ras that is part of a signaling pathway known as the RAS/MAPK pathway. The protein relays signals from outside the cell to the cell's nucleus. These signals instruct the cell to grow and divide (proliferate) or to mature and take on specialized functions (differentiate). The K-Ras protein is a GTPase, which means it converts a molecule called GTP into another molecule called GDP. In this way the K-Ras protein acts like a switch that is turned on and off by the GTP and GDP molecules. To transmit signals, it must be turned on by attaching (binding) to a molecule of GTP. The K-Ras protein is turned off (inactivated) when it converts the GTP to GDP. When the protein is bound to GDP, it does not relay signals to the cell's nucleus.

The KRAS gene belongs to a class of genes known as oncogenes. When mutated, oncogenes have the potential to cause normal cells to become cancerous. The KRAS gene is in the Ras family of oncogenes, which also includes two other genes: [HRAS](https://ghr.nlm.nih.gov/gene/HRAS) and [NRAS](https://ghr.nlm.nih.gov/gene/NRAS). These proteins play important roles in cell division, cell differentiation, and the self-destruction of cells (apoptosis).

#KRAS and lung cancer

At least three mutations in the KRAS gene have been associated with lung cancer. Lung cancer is a disease in which certain cells in the lungs become abnormal and multiply uncontrollably to form a tumor. Lung cancer may not cause signs or symptoms in its early stages. These KRAS gene mutations are somatic, which means they are acquired during a person's lifetime and are present only in tumor cells. Somatic mutations are not inherited. Nearly all of the KRAS gene mutations associated with lung cancer change the amino acid glycine at position 12 or 13 (Gly12 or Gly13) or change the amino acid glutamine at position 61 (Gln61) in the K-Ras protein. These mutations result in a K-Ras protein that is constantly turned on (constitutively activated) and directing cells to proliferate in an uncontrolled way, which leads to tumor formation. When these genetic changes occur in cells in the lungs, lung cancer can develop.

KRAS gene mutations are found in 15 to 25 percent of all lung cancer cases but are more frequent in white populations than in Asian populations; 25 to 50 percent of whites with lung cancer have KRAS gene mutations, whereas 5 to 15 percent of Asians with lung cancer have KRAS gene mutations.

KRAS gene mutations are much more common in long-term tobacco smokers with lung cancer than in nonsmokers. Lung cancers with KRAS gene mutations typically indicate a poor prognosis and are associated with resistance to several cancer treatments.

#Link to Protein Databank:
[Mutant KRAS interacting with AMG 510](https://www.rcsb.org/pdb/explore/jmol.do?structureId=6oim&bionumber=1&jmolMode=HTML5)

#Peter Mac video on What Goes Wrong In Cancer:
`)).append(`<iframe width="560" height="315" src="https://www.youtube.com/embed/s8GxvVrnF38?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`);
}

let images = {{{imagesJson}}}.reduce((acc,d) => {
    const blob = d;
    blob.lines = new Array();
    acc[d.id] = blob;
    return acc;
}, {});

{{#lineData}}
images = {{{lineData}}}
{{/lineData}}

let currentScreen = null;
welcome();

function hideEverything() {
    $("#contentBox").html("");
    d3.selectAll(".bigText").classed("hidden", true);
    d3.selectAll(".drawer").classed("hidden", true);
    d3.select("#noteBox").classed("hidden", true);
    d3.select("#emailForm").classed("hidden", true);

    if(currentScreen) {
        console.log("saving data for "+currentScreen);
        console.log(drawing_data.lines);
        images[currentScreen].lines = drawing_data.lines.map(d => {
            return {
                points: d.points,
                color: d.color
            };
        });

        $("#lineData").val(JSON.stringify(images));
    } else {
        console.log("Not on a screen to save..?");
    }

}

function openScreen(id){
    hideEverything();
    d3.select("#noteBox").classed("hidden", false);
    const blob = drawing_data = images[id],
          image = blob.image;
    currentScreen = id;

    paint(drawing_data);

    d3.select(".drawer").classed("hidden", false);
    d3.select("#d3-background-image").attr("src", `/images/${image}`);



    var div = d3.select("#contentBox").append("div");
    div.append("img").attrs({
        class: "bigImage",
        src: `/images/${image}`
    });
    div2 = d3.select("#contentBox").append("div");
    {{! div2.append("h3").text("Notes:"); }}
    d3.select(`#text-${id}`).classed("hidden", false);

    {{! div2.append("textarea").attrs({
        class: "bigText"
    }); }}
}

function email() {
    hideEverything();
    d3.select("#emailForm").classed("hidden", false);
}

</script>

</body>

</html>